# Forecast Web API Notes

## Follow-up Work

This is a list of things that are sub-optimal that I would certainly want to improve with additional time.

1. Accept latitude and longitude as query string parameters instead of URL parts.
2. Document the swagger APIs with more explanations for usage.
3. Block adding a duplicate location. Consider using PUT or be strict and return an error.
4. Paginated result support for any API that "gets all" items
5. Use simple status codes over returning all the data in the current set after a CRUD operation. This was done this way just for development purposes, but does not scale.
6. Fix todos or create tickets to track work.
7. Factor out the dev password to something not checked in.

## Running the Project

In a terminal window, run the following from the root of the project:

```sh
docker compose up -d
dotnet ef database update
dotnet run
```

## Dev Environment

This was developed on a MacBook using Ventura 13.5.2. This environment setup should be mostly compatible with a Windows machine as well but has not been tested with one.

- Visual Studio Code with the following extensions:
  - ms-dotnettools.csharp
  - ms-dotnettools.csdevkit
  - kreativ-software.csharpextensions
  - esbenp.prettier-vscode
  - formulahendry.dotnet-test-explorer
- .NET SDK using command `brew install --cask dotnet-sdk`
- Docker Desktop

```sh
dotnet new webapi
dotnet watch run
dotnet add package AutoMapper.Extensions.Microsoft.DependencyInjection
dotnet add package Microsoft.EntityFrameworkCore
dotnet add package Npgsql.EntityFrameworkCore.Post
dotnet add package Microsoft.EntityFrameworkCore.Design
docker compose up
dotnet tool install --global dotnet-ef
```

During development run the following two commands in separate terminal windows:

```sh
docker compose up
dotnet watch run
```

## Record of dev commands run

```sh
dotnet ef migrations add InitialCreate
dotnet ef database update
dotnet ef migrations add ForecastSeeding
dotnet ef database update
```

Log of `database update` command:

```txt
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (15ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT EXISTS (
          SELECT 1 FROM pg_catalog.pg_class c
          JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
          WHERE n.nspname='public' AND
                c.relname='__EFMigrationsHistory'
      )
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (10ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      CREATE TABLE "__EFMigrationsHistory" (
          "MigrationId" character varying(150) NOT NULL,
          "ProductVersion" character varying(32) NOT NULL,
          CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
      );
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT EXISTS (
          SELECT 1 FROM pg_catalog.pg_class c
          JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
          WHERE n.nspname='public' AND
                c.relname='__EFMigrationsHistory'
      )
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT "MigrationId", "ProductVersion"
      FROM "__EFMigrationsHistory"
      ORDER BY "MigrationId";
info: Microsoft.EntityFrameworkCore.Migrations[20402]
      Applying migration '20231012045145_InitialCreate'.
Applying migration '20231012045145_InitialCreate'.
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (3ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      CREATE TABLE "Forecasts" (
          "Id" integer GENERATED BY DEFAULT AS IDENTITY,
          "Latitude" real NOT NULL,
          "Longitude" real NOT NULL,
          "Temperature" real NOT NULL,
          "TemperatureUnit" integer NOT NULL,
          CONSTRAINT "PK_Forecasts" PRIMARY KEY ("Id")
      );
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
      VALUES ('20231012045145_InitialCreate', '7.0.12');
Done.
```
